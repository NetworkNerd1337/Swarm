{% extends "base.html" %}

{% block title %}Metrics Dashboard - StreamSwarm{% endblock %}

{% block content %}
<div class="container">
    <!-- Header -->
    <div class="row mb-4">
        <div class="col">
            <div class="d-flex align-items-center mb-3">
                <img src="{{ url_for('static', filename='images/logo.png') }}" alt="StreamSwarm" height="48" class="me-3">
                <div>
                    <h1 class="h2 mb-1">
                        <i class="fas fa-chart-bar me-2"></i>
                        Enhanced Metrics Dashboard
                    </h1>
                    <p class="text-muted mb-0">Real-time view of all 35+ performance metrics collected by clients</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Metrics Categories -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-layer-group me-2"></i>
                        Available Metrics Categories
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6 col-lg-3 mb-3">
                            <div class="card bg-dark border-primary">
                                <div class="card-body text-center">
                                    <i class="fas fa-network-wired fa-2x text-primary mb-2"></i>
                                    <h6 class="card-title text-primary">Network Performance</h6>
                                    <small class="text-info">7 metrics</small>
                                    <ul class="list-unstyled mt-2 small text-light">
                                        <li>• Network Latency</li>
                                        <li>• Packet Loss</li>
                                        <li>• Network Jitter</li>
                                        <li>• DNS Resolution Time</li>
                                        <li>• TCP Connect Time</li>
                                        <li>• SSL Handshake Time</li>
                                        <li>• Time to First Byte</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-6 col-lg-3 mb-3">
                            <div class="card bg-dark border-success">
                                <div class="card-body text-center">
                                    <i class="fas fa-microchip fa-2x text-success mb-2"></i>
                                    <h6 class="card-title text-success">CPU Monitoring</h6>
                                    <small class="text-info">7 metrics</small>
                                    <ul class="list-unstyled mt-2 small text-light">
                                        <li>• CPU Usage %</li>
                                        <li>• Load Averages (1,5,15min)</li>
                                        <li>• CPU Frequency</li>
                                        <li>• Context Switches</li>
                                        <li>• Interrupts</li>
                                        <li>• CPU Temperature</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-6 col-lg-3 mb-3">
                            <div class="card bg-dark border-info">
                                <div class="card-body text-center">
                                    <i class="fas fa-memory fa-2x text-info mb-2"></i>
                                    <h6 class="card-title text-info">Memory Analysis</h6>
                                    <small class="text-info">8 metrics</small>
                                    <ul class="list-unstyled mt-2 small text-light">
                                        <li>• Memory Usage %</li>
                                        <li>• Available Memory</li>
                                        <li>• Cached Memory</li>
                                        <li>• Buffer Memory</li>
                                        <li>• Shared Memory</li>
                                        <li>• Swap Usage</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-6 col-lg-3 mb-3">
                            <div class="card bg-dark border-warning">
                                <div class="card-body text-center">
                                    <i class="fas fa-hdd fa-2x text-warning mb-2"></i>
                                    <h6 class="card-title text-warning">Storage Performance</h6>
                                    <small class="text-info">7 metrics</small>
                                    <ul class="list-unstyled mt-2 small text-light">
                                        <li>• Disk Usage %</li>
                                        <li>• Read/Write IOPS</li>
                                        <li>• Read/Write Throughput</li>
                                        <li>• Disk Utilization</li>
                                        <li>• Disk Temperature</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <div class="card bg-dark border-danger">
                                <div class="card-body text-center">
                                    <i class="fas fa-ethernet fa-2x text-danger mb-2"></i>
                                    <h6 class="card-title text-danger">Network Interface Stats</h6>
                                    <small class="text-info">8 metrics</small>
                                    <ul class="list-unstyled mt-2 small text-light">
                                        <li>• Bytes Sent/Received</li>
                                        <li>• Packets Sent/Received</li>
                                        <li>• Network Errors In/Out</li>
                                        <li>• Network Drops In/Out</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-6 col-lg-4 mb-3">
                            <div class="card bg-dark border-secondary">
                                <div class="card-body text-center">
                                    <i class="fas fa-cogs fa-2x text-secondary mb-2"></i>
                                    <h6 class="card-title text-light">System Activity</h6>
                                    <small class="text-info">3 metrics</small>
                                    <ul class="list-unstyled mt-2 small text-light">
                                        <li>• Process Count</li>
                                        <li>• TCP Connections</li>
                                        <li>• Open File Descriptors</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-6 col-lg-4 mb-3">
                            <div class="card bg-dark border-primary">
                                <div class="card-body text-center">
                                    <i class="fas fa-layer-group fa-2x text-primary mb-2"></i>
                                    <h6 class="card-title text-primary">Quality of Service</h6>
                                    <small class="text-info">5 metrics</small>
                                    <ul class="list-unstyled mt-2 small text-light">
                                        <li>• DSCP Code Points</li>
                                        <li>• CoS Values</li>
                                        <li>• Traffic Classification</li>
                                        <li>• QoS Policy Compliance</li>
                                        <li>• Per-Class Bandwidth</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Where to Find Metrics -->
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-map-marker-alt me-2"></i>
                        Where to View These Metrics
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <div class="text-center">
                                <i class="fas fa-chart-line fa-3x text-primary mb-3"></i>
                                <h6>Test Results Page</h6>
                                <p class="text-muted small">Go to Tests → View Results → Select any metric from the enhanced dropdown</p>
                                <a href="{{ url_for('tests') }}" class="btn btn-outline-primary btn-sm">
                                    <i class="fas fa-flask me-1"></i>
                                    View Tests
                                </a>
                            </div>
                        </div>
                        
                        <div class="col-md-4 mb-3">
                            <div class="text-center">
                                <i class="fas fa-desktop fa-3x text-success mb-3"></i>
                                <h6>Client Details Modal</h6>
                                <p class="text-muted small">Go to Clients → Click on any client → View detailed system metrics</p>
                                <a href="{{ url_for('clients') }}" class="btn btn-outline-success btn-sm">
                                    <i class="fas fa-desktop me-1"></i>
                                    View Clients
                                </a>
                            </div>
                        </div>
                        
                        <div class="col-md-4 mb-3">
                            <div class="text-center">
                                <i class="fas fa-tachometer-alt fa-3x text-info mb-3"></i>
                                <h6>Dashboard Overview</h6>
                                <p class="text-muted small">Main dashboard shows aggregated statistics from enhanced metrics</p>
                                <a href="{{ url_for('dashboard') }}" class="btn btn-outline-info btn-sm">
                                    <i class="fas fa-tachometer-alt me-1"></i>
                                    View Dashboard
                                </a>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Application-Layer Metrics -->
                    <div class="col-md-4 mb-4">
                        <div class="card h-100" data-bs-theme="dark">
                            <div class="card-header">
                                <h6 class="card-title mb-0">
                                    <i class="fas fa-globe me-2"></i>
                                    Application-Layer
                                </h6>
                            </div>
                            <div class="card-body">
                                <div class="row text-center">
                                    <div class="col-6">
                                        <div class="metric-value">{{ "%.1f"|format(latest_result.content_download_time or 0) }}ms</div>
                                        <div class="metric-label">Content Download</div>
                                    </div>
                                    <div class="col-6">
                                        <div class="metric-value">{{ "%.1f"|format(latest_result.compression_ratio or 0) }}%</div>
                                        <div class="metric-label">Compression Ratio</div>
                                    </div>
                                </div>
                                <div class="row text-center mt-2">
                                    <div class="col-6">
                                        <div class="metric-value">{{ "%.1f"|format(latest_result.connection_reuse_ratio or 0) }}%</div>
                                        <div class="metric-label">Connection Reuse</div>
                                    </div>
                                    <div class="col-6">
                                        <div class="metric-value">{{ "%.1f"|format(latest_result.certificate_validation_time or 0) }}ms</div>
                                        <div class="metric-label">Cert Validation</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Performance Profiling -->
                    <div class="col-md-4 mb-4">
                        <div class="card h-100" data-bs-theme="dark">
                            <div class="card-header">
                                <h6 class="card-title mb-0">
                                    <i class="fas fa-chart-line me-2"></i>
                                    Performance Profiling
                                </h6>
                            </div>
                            <div class="card-body">
                                <div class="row text-center">
                                    <div class="col-6">
                                        <div class="metric-value">{{ "%.1f"|format(latest_result.dns_cache_hit_ratio or 0) }}%</div>
                                        <div class="metric-label">DNS Cache</div>
                                    </div>
                                    <div class="col-6">
                                        <div class="metric-value">{{ "%.1f"|format(latest_result.cdn_performance_score or 0) }}/100</div>
                                        <div class="metric-label">CDN Performance</div>
                                    </div>
                                </div>
                                <div class="row text-center mt-2">
                                    <div class="col-6">
                                        <div class="metric-value">{{ "%.1f"|format(latest_result.application_response_time or 0) }}ms</div>
                                        <div class="metric-label">App Response</div>
                                    </div>
                                    <div class="col-6">
                                        <div class="metric-value">
                                            {% if latest_result.multipath_detected %}
                                                <span class="badge bg-success">Yes</span>
                                            {% else %}
                                                <span class="badge bg-secondary">No</span>
                                            {% endif %}
                                        </div>
                                        <div class="metric-label">Multipath</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Infrastructure Monitoring -->
                    <div class="col-md-4 mb-4">
                        <div class="card h-100" data-bs-theme="dark">
                            <div class="card-header">
                                <h6 class="card-title mb-0">
                                    <i class="fas fa-server me-2"></i>
                                    Infrastructure Health
                                </h6>
                            </div>
                            <div class="card-body">
                                <div class="row text-center">
                                    <div class="col-6">
                                        <div class="metric-value">
                                            {% if latest_result.power_consumption_watts %}
                                                {{ "%.1f"|format(latest_result.power_consumption_watts) }}W
                                            {% else %}
                                                N/A
                                            {% endif %}
                                        </div>
                                        <div class="metric-label">Power Usage</div>
                                    </div>
                                    <div class="col-6">
                                        <div class="metric-value">{{ "%.1f"|format(latest_result.memory_error_rate or 0) }}</div>
                                        <div class="metric-label">Memory Errors</div>
                                    </div>
                                </div>
                                <div class="row text-center mt-2">
                                    <div class="col-6">
                                        <div class="metric-value">
                                            {% if latest_result.smart_drive_health %}
                                                {% set smart_data = latest_result.smart_drive_health | from_json %}
                                                {% if smart_data %}
                                                    <span class="badge bg-success">Healthy</span>
                                                {% else %}
                                                    <span class="badge bg-secondary">N/A</span>
                                                {% endif %}
                                            {% else %}
                                                <span class="badge bg-secondary">N/A</span>
                                            {% endif %}
                                        </div>
                                        <div class="metric-label">Drive Health</div>
                                    </div>
                                    <div class="col-6">
                                        <div class="metric-value">
                                            {% if latest_result.fan_speeds_rpm %}
                                                {% set fan_data = latest_result.fan_speeds_rpm | from_json %}
                                                {% if fan_data %}
                                                    {{ fan_data.values() | list | length }}
                                                {% else %}
                                                    N/A
                                                {% endif %}
                                            {% else %}
                                                N/A
                                            {% endif %}
                                        </div>
                                        <div class="metric-label">Active Fans</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}